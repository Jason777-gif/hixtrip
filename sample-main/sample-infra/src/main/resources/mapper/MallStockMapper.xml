<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hixtrip.sample.infra.db.mapper.MallStockMapper">

    <resultMap id="MallStockMap" type="com.hixtrip.sample.infra.db.dataobject.MallStockDO">
        <id property="id" column="id" jdbcType="BIGINT"/>
        <result property="skuId" column="sku_id" jdbcType="BIGINT"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="quantity" column="quantity" jdbcType="INTEGER"/>
    </resultMap>

    <insert id="saveOrUpdate" parameterType="com.hixtrip.sample.infra.db.dataobject.MallStockDO">
        insert into `mall-stock`(`sku_id`,`create_time`,`quantity`)
        values(#{stock.skuId},#{stock.createTime},#{stock.quantity})
         ON DUPLICATE KEY UPDATE update_time = now() ,`quantity` = values(`quantity`)
    </insert>

    <select id="findOrderBySkuId" resultMap="MallStockMap">
        select `sku_id`,`create_time`,`quantity` from `mall-stock` where `sku_id` =#{skuId}
    </select>

    <update id="updateStockBySkuId">
        update `sku_id` set `quantity` =#{quantity} where `sku_id` =#{skuId} for update
    </update>

</mapper>